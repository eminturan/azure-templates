parameters:
- name: workingDirectory
  type: string
  default: ''
- name: registry_url
  type: string
  default: ''
- name: image_name
  type: string
  default: ''

steps:

- task: CopyFiles@2
  inputs:
    SourceFolder: '$(Build.ArtifactStagingDirectory)'
    contents: '**'
    targetFolder: "${{ parameters.workingDirectory }}"

- task: CmdLine@2
  displayName: Docker Build
  inputs:
    script: |
      ls
      pwd
      echo "$(Build.SourcesDirectory)"
      echo "$(Pipeline.Workspace)"
      cd "${{ parameters.workingDirectory }}"
      #pwd
      docker build -t ${{ parameters.registry_url }}/${{ parameters.image_name }}:$(Build.BuildId) .
